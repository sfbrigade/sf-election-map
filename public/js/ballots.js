var ballots =[
   {
      "pass": true,
      "topass": '66⅔%',
      "title":"San Francisco Transportation and Road Improvement Bond",
      "letter":"A",
      "about":"To construct, redesign and rebuild streets and sidewalks and to make infrastructure repairs and improvements that increase MUNI service reliability, ease traffic congestion, reduce vehicle travel times, enhance pedestrian and bicycle safety, and improve disabled access, shall the City and County of San Francisco issue $500 million in general obligation bonds, subject to independent citizen oversight and regular audits? ",
      "cmt_for":[
         {
            "filer_naml":[
               "Committee for Reliable Transportation and Better, Safer Streets",
               "Committee for Reliable Transportation %26 Better, Safer Streets, Yes on A"
            ],
            "filer_id":"1367740"
         },
         {
          "filer_naml":[
              "COMMITTEE FOR A BRIGHTER SAN FRANCISCO FUTURE",
              "COMMITTEE FOR A BRIGHTER SAN FRANCISCO FUTURE, SUPPORTING PROPS. A, C, I, J AND K 2014"
          ],
          "filer_id": ""
         }

      ],
      "cmt_against":[
      
      ]
   },
      {
        "pass": true, 
      "topass": "50%+1",
   "title": "Adjusting Transportation Funding for Population Growth",
   "letter":"B",
   "about":"Shall the City amend the Charter to increase the amount the City provides to the Municipal Transportation Agency based on increases in the City’s population, with such funds to be used to improve Muni and to improve street safety? ",
   "cmt_for": [
            
      ],
   "cmt_against": [
         
      ] 
   },
   {
    "pass": true,
    "topass": "50%+1",
      "title":"Children's Fund; Public Education Enrichment Fund; Children and Families Council; Rainy Day Reserve",
      "letter":"C",
      "about":"Shall the City amend the Charter to support services to children, youth, and their families by extending the Children’s Fund for 25 years and increasing its funding; extending the Public Education Enrichment Fund for 26 years; creating an Our Children, Our Families Council; and dividing the existing Rainy Day Reserve into a City Rainy Day Reserve and a School District Rainy Day Reserve?",
          "cmt_for":[
      {
        "filer_naml":[
          "Children and Family First Committee",
          "Children and Family First Committee, Yes on C"
        ],
        "filer_id":"1367736"
      },
      {
        "filer_naml":[
          "Support Our Children Our City Fund",
          "Yes on C"
        ],
        "filer_id":"1366048"
      },
      {
          "filer_naml":[
              "COMMITTEE FOR A BRIGHTER SAN FRANCISCO FUTURE",
              "COMMITTEE FOR A BRIGHTER SAN FRANCISCO FUTURE, SUPPORTING PROPS. A, C, I, J AND K 2014"
          ],
          "filer_id": ""
      }
    ],
      "cmt_against":[
         
      ]
   },
   {
    "pass": true,
    "topass": "50%+1" ,
   "title": "Retiree Health Benefits for Former Redevelopment Agency and Successor Agency Employees",
   "letter":"D",
   "about":"Shall the City amend the Charter to make retiree health care benefits available to certain employees of the former San Francisco Redevelopment Agency and the Successor Agency?",
   "cmt_for": [
            
      ],
   "cmt_against": [
         
      ] 
   },
   {
    "pass": false,
    "topass":"66⅔%",
      "title":"Tax on Sugar-Sweetened Beverages",
      "letter":"E",
      "about":"Shall the City collect a tax of 2 cents per ounce from the distributors of sugar-sweetened beverages to fund health, nutrition, physical education and active recreation programs?",
      "cmt_for":[
         {
            "filer_naml":[
               "Yes on E - Choose Health SF"
            ],
            "filer_id":"1362913"
         }
      ],
      "cmt_against":[
             {
        "filer_naml":[
          "NO ON E: STOP UNFAIR BEVERAGE TAXES, COALITION FOR AN AFFORDABLE CITY, WITH MAJOR FUNDING BY AMERICAN BEVERAGE ASSOCIATION CALIFORNIA PAC"
        ],
        "filer_id":"1368526"
      }
        
      ]
   },
   {
    "pass": true, 
    "topass": "50%+1",
      "title":"Pier 70",
      "letter":"F",
      "about":"Shall the City increase the height limit for new buildings on the 28-acre development site in the Pier 70 area from 40 feet to 90 feet; and shall it be City policy to encourage the City to proceed with public approval processes, including environmental review, for this mixed-use project, and encourage parks, housing, cultural space, and job creation for this site?",
      "cmt_for":[
         {
            "filer_naml":[
               "NEIGHBORS FOR HOUSING AND PARKS AT UNION IRON WORKS, WITH MAJOR SUPPORT FROM FC PIER 70, LLC",
                "YES ON F, WITH MAJOR SUPPORT FROM FC PIER 70, LLC"
            ],
            "filer_id":"1367199"
         }
      ],
      "cmt_against":[
         
      ]
   },
   {
    "pass": false,
    "topass": "50%+1",
   "title": "Additional Transfer Tax on Residential Property Sold Within 5 Years of Purchase",
   "letter":"G",
   "about":"Shall the City impose an additional tax of between 14% and 24% on the total sale price of certain multi-unit residential properties that are sold within five years of purchase or transfer, subject to certain exceptions? ",
"cmt_for":[
      {
        "filer_naml":[
          "San Franciscans Against Real Estate Speculation",
          "San Franciscans Against Real Estate Speculation, A Committee for Proposition G"
        ],
        "filer_id":"1367823"
      }
    ],
    "cmt_against":[
      {
        "filer_naml":[
          "Stop the Housing Tax, No on G, a coalition of homeowners, renters, and real estate organizations"
        ],
        "filer_id":"1369949"
      }
    ] 
   },
   {
    "pass": false, 
    "topass": "50%+1",
      "title":"Requiring Certain Golden Gate Park Athletic Fields To Be Kept As Grass With No Artificial Lighting",
      "letter":"H",
      "about":"Shall the City be required to keep natural grass at all athletic fields in Golden Gate Park west of Crossover Drive and to prohibit nighttime sports field lighting in these areas? ",
      "cmt_for":[
         {
            "filer_naml":[
               "Coalition to Protect Golden Gate Park"
            ],
            "filer_id":"pending"
         }
      ],
      "cmt_against":[
         {
            "filer_naml":[
               "LET SF KIDS PLAY"
            ],
            "filer_id":"1367433"
         }
      ]
   },
   {
    "pass": true, 
    "topass": "50%+1",
      "title":"Renovation of Playgrounds, Walking Trails, and Athletic Fields",
      "letter":"I",
      "about":"Lorem ipsum dolor sit amet, consectetur adipiscing elit. In tempor vitae leo suscipit pellentesque. ",
      "cmt_for":[
         {
            "filer_naml":[
               "LET SF KIDS PLAY"
            ],
            "filer_id":"1367433"
         },
        {
            "filer_naml":[
                "COMMITTEE FOR A BRIGHTER SAN FRANCISCO FUTURE",
                "COMMITTEE FOR A BRIGHTER SAN FRANCISCO FUTURE, SUPPORTING PROPS. A, C, I, J AND K 2014"
            ],
            "filer_id": ""
        }
      ],
      "cmt_against":[
         {
            "filer_naml":[
               "Coalition to Protect Golden Gate Park"
            ],
            "filer_id":"pending"
         }
      ]
   },
   {
    "pass": true, 
    "topass": "50%+1",
      "title":"Minimum Wage Increase",
      "letter":"J",
      "about":"Shall the City gradually increase the minimum wage to $15 per hour by July 1, 2018, with further increases based on inflation? ",
      "cmt_for":[
         {
            "filer_naml":[
               "San Franciscans for a Safe and Affordable City, with major funding by San Francisco Police Officers Association PAC and San Francisco Fire Fighters PAC",
               "San Franciscans for a Safe and Affordable City, with major funding by San Francisco Police Officers Association PAC and San Francisco Fire Fighters PAC, Yes on J"
            ],
            "filer_id":"1364449"
         },
         {
            "filer_naml":[
               "Campaign for a Fair Economy and Higher Wages, sponsored by community and labor organizations", 
               "Campaign for a Fair Economy and Higher Wages, sponsored by community and labor organizations, Yes on Proposition J"
            ],
            "filer_id":"1367310"
         },
         {
            "filer_naml":[
               "Committee for Better Wages",
               "Committee for Better Wages, Yes on J"
            ],
            "filer_id":"1367738"
         },
        {
            "filer_naml":[
                "COMMITTEE FOR A BRIGHTER SAN FRANCISCO FUTURE",
                "COMMITTEE FOR A BRIGHTER SAN FRANCISCO FUTURE, SUPPORTING PROPS. A, C, I, J AND K 2014"
            ],
            "filer_id": ""
        }
      ],
      "cmt_against":[
         
      ]
   },
   {
    "pass": true, 
    "topass": " 50%+1",
   "title": "Affordable Housing",
   "letter":"K",
   "about":"Shall it be City policy to help construct or rehabilitate at least 30,000 homes by 2020, more than 50% of which will be affordable for middle-class households and more than 33% of which will be affordable for low- and moderate-income households, and secure sufficient funding to achieve that goal?",
   "cmt_for": [
      {
        "filer_naml":[
          "Coalition for Affordable Housing, a Committee for Proposition K"
        ],
        "filer_id":"1369298"
      },
      {
          "filer_naml":[
              "COMMITTEE FOR A BRIGHTER SAN FRANCISCO FUTURE",
              "COMMITTEE FOR A BRIGHTER SAN FRANCISCO FUTURE, SUPPORTING PROPS. A, C, I, J AND K 2014"
          ],
          "filer_id": ""
      }
            
      ],
   "cmt_against": [
         
      ] 
   },
   {
    "pass": false,
    "topass": "50%+1",
      "title":"Policy Regarding Transportation Priorities",
      "letter":"L",
      "about":"Shall it be City policy to change parking and transportation priorities? ",
      "cmt_for":[
         {
            "filer_naml":[
               "Restore Transportation Balance, A Committee in Support of Proposition L"
            ],
            "filer_id":"1366989"
         }
      ],
      "cmt_against":[
         {
        "filer_naml":[
          "No on L, San Franciscans Against Gridlock"
        ],
        "filer_id":"1371708"
      }
         
      ]
   }
];


var ballotNames =[];
var ballotObs = [];

ballots.forEach(function(d){
    
      d.cmt_for.forEach(function(p){
            var forQuery='';
           
            var ob={};
            ob[p.filer_naml[0]] = p.filer_id;
            //ob.id = p.filer_id;

            ballotNames.push(p.filer_naml[0]);
            ballotObs.push(ob);

            p.filer_naml.forEach(function(f,i){
              
              var ln = p.filer_naml.length;
              if(ln>1){
                  if(i==0){
                    forQuery+="$where=";
                  }
                
                  if(i<ln-1){
                    forQuery+= "filer_naml ='"+ f + "' OR ";
                  }
                  else{
                    forQuery+="filer_naml ='"+ f +"'";
                  }
               }
               else{
                  forQuery+="filer_naml=" + f;
               } 

            });

            p.query = forQuery;
      })
      d.cmt_against.forEach(function(e){
            var ob={};
             var agQuery='';
            ob[e.filer_naml[0]] = e.filer_id;

            ballotNames.push(e.filer_naml[0]);
            ballotObs.push(ob);

             e.filer_naml.forEach(function(f,i){
              var ln = e.filer_naml.length;
              if(ln>1){
                  if(i==0){
                    agQuery+="$where=";
                  }
                  if(i<ln-1){
                    agQuery+= "filer_naml ='"+ f + "' OR ";
                  }
                  else{
                    agQuery+="filer_naml ='"+ f + "'";
                  }
               }
               else{
                  agQuery+="filer_naml=" + f;
               } 

            });

            e.query = agQuery;
      })



});

console.log(ballots);
